<h2>ショッピングカート</h2>
<% if @cart_products.count == 0 %>
  ...カートには何も入っていません...
<% else %>
  <div class="all-delete">
    <%= link_to "カートを空にする", cart_product_destroy_all_path, method: :delete %>
  </div>
  <div class="cart-items">
    <table>
      <thead>
        <tr>
          <th>商品名</th>
          <th>単価（税込）</th>
          <th>数量</th>
          <th>小計</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @cart_products.each do |cart_product| %>
          <tr>
            <% taxincluded = (cart_product.product.price*$tax).floor %>
            <% sum = taxincluded*cart_product.count %>
            <% @total_price += sum %>
            <td><%= attachment_image_tag(cart_product.product, :image, fallback: "no_image.jpg", size: "50x50" ) %><%= cart_product.product.name %></td>
            <td><%= taxincluded %></td>
            <td>
              <%= form_with model: @cart_product, url: cart_product_path(cart_product.id), local: true, method: :patch do |f| %>
                <div class="form-group">
                  <%= f.select :count, [["1", "1"], ["2", "2"], ["3", "3"], ["4", "4"], ["5", "5"], ["6", "6"], ["7", "7"], ["8", "8"], ["9", "9"], ["10", "10"]], include_blank: "#{cart_product.count}" %>
                  <%= f.submit '変更'%>
                </div>
              <% end %>
            </td>
            <td><%= sum %></td>
            <td><%= link_to "削除する", cart_product_path(cart_product.id), method: :delete %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="total-price">
    合計金額 <%= @total_price %>
  </div>
<% end %>
<div class="links">
  <%= link_to '買い物を続ける', products_path %>
  <%= link_to '情報入力に進む', new_orders_path %>
</div>